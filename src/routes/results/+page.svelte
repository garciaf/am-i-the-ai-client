<script lang="ts">
	import { goto } from '$app/navigation';
	import { gameStore } from '$lib/stores/game';

	const aiAnswerId = '3'; // In real app, this would come from server

	function playAgain() {
		gameStore.update(state => ({
			...state,
			phase: 'question',
			currentQuestion: null,
			answers: []
		}));
		goto('/question');
	}

	function backToLobby() {
		gameStore.update(state => ({
			...state,
			phase: 'lobby',
			currentQuestion: null,
			answers: []
		}));
		goto(`/waiting-room?lobbyId=${$gameStore.lobbyId}`);
	}
</script>

<div class="max-w-4xl mx-auto">
	<div class="border-2 border-green-400 p-8 bg-slate-800">
		<div class="mb-6 text-center">
			<div class="text-green-300 mb-2">&gt; PHASE: RESULTS</div>
			<div class="text-2xl font-bold text-green-400">ROUND COMPLETE</div>
		</div>

		<div class="border-2 border-green-400 p-4 mb-6 bg-slate-900">
			<div class="text-green-300 text-sm mb-2">&gt; THE QUESTION WAS:</div>
			<div class="text-lg text-green-400">{$gameStore.currentQuestion}</div>
		</div>

		<div class="mb-6">
			<div class="text-green-300 mb-4">&gt; VOTING RESULTS:</div>

			<div class="space-y-4">
				{#each $gameStore.answers.sort((a, b) => b.votes - a.votes) as answer}
					<div class="bg-slate-900 border-2 p-4 {
						answer.playerId === aiAnswerId ? 'border-red-400' : 'border-green-400'
					}">
						<div class="flex justify-between mb-2">
							<div class="text-green-300 text-sm">
								&gt; {answer.playerId === aiAnswerId ? '[AI RESPONSE]' : 'HUMAN RESPONSE'}
							</div>
							<div class="text-green-400 font-bold">{answer.votes} VOTES</div>
						</div>
						<div class="text-green-400">{answer.text}</div>
						{#if answer.playerId === aiAnswerId}
							<div class="mt-2 text-red-400 text-sm">
								âš  THIS WAS GENERATED BY AI
							</div>
						{/if}
					</div>
				{/each}
			</div>
		</div>

		<div class="grid grid-cols-2 gap-4">
			<button
				onclick={backToLobby}
				class="bg-slate-900 border-2 border-green-400 text-green-400 p-4 font-bold hover:bg-green-400 hover:text-slate-900 transition-colors"
			>
				[BACK TO LOBBY]
			</button>
			<button
				onclick={playAgain}
				class="bg-green-400 text-slate-900 p-4 font-bold hover:bg-green-300 transition-colors"
			>
				[PLAY AGAIN]
			</button>
		</div>

		<div class="mt-6 text-center">
			<div class="text-green-300 text-sm">
				&gt; SYSTEM STATUS: READY FOR NEXT ROUND
			</div>
		</div>
	</div>
</div>
